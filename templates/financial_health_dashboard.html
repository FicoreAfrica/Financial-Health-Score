<!DOCTYPE html>
<html lang="{{ language }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track your financial health with Ficore AI. See your score, earn badges, and get smart insights.">
    <meta name="keywords" content="ficore ai, financial health, dashboard, Africa SME finance, smart insights">
    <meta name="author" content="Ficore AI">
    <title>Ficore Africa - {{ translations[language]['Your Financial Health Dashboard'] }}</title>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            background: linear-gradient(135deg, #E3F2FD, #F5F7FA);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }
        .container {
            max-width: 1000px;
            margin: auto;
        }
        .progress-tracker {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .step {
            width: 30px;
            height: 30px;
            background: #E0E0E0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-weight: 600;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .step.active {
            background: #28A745;
            color: white;
        }
        .step.completed {
            background: #1E88E5;
            color: white;
        }
        .card {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.5s forwards;
            border: 1px solid #E0E0E0;
        }
        @keyframes slideIn {
            to { opacity: 1; transform: translateY(0); }
        }
        .card-header {
            background: linear-gradient(135deg, #28A745, #1E88E5);
            color: white;
            padding: 1.5rem;
            border-radius: 15px 15px 0 0;
            text-align: center;
            font-weight: 700;
            font-size: 2rem;
            position: relative;
            overflow: hidden;
        }
        .card-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            animation: rotate 10s infinite linear;
            border-radius: 50%;
        }
        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }
        .card-body {
            padding: 1.5rem;
        }
        .badge {
            display: inline-block;
            background: #42A5F5;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            margin: 5px;
            font-size: 1rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #1565C0;
            cursor: pointer;
        }
        .badge:hover {
            transform: scale(1.15);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-primary, .btn-secondary {
            padding: 12px 25px;
            font-weight: 600;
            border-radius: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #28A745, #1E88E5);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #F57C00, #FF9800);
        }
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        }
        .course-link, .enroll-button {
            padding: 12px 25px;
            font-weight: 600;
            border-radius: 10px;
            transition: transform 0.3s ease;
        }
        .course-link {
            background: #FFC107;
            color: black;
        }
        .enroll-button {
            background: #FFC107;
            color: black;
        }
        .course-link:hover, .enroll-button:hover {
            transform: translateY(-3px);
        }
        .try-it-btn {
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        .try-it-btn:hover {
            transform: translateY(-2px);
        }
        .chart-container {
            position: relative;
            min-height: 350px;
        }
        #score-breakdown-chart, #compare-others-chart {
            width: 100%;
            height: 350px;
        }
        .voice-btn {
            background: #9C27B0;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        .voice-btn:hover {
            transform: translateY(-2px);
        }
        @media (max-width: 600px) {
            .card-header { font-size: 1.5rem; padding: 1rem; }
            .badge { font-size: 0.85rem; padding: 8px 10px; }
            .btn-primary, .btn-secondary { padding: 10px 20px; }
            #score-breakdown-chart, #compare-others-chart { height: 250px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="step {% if step >= 1 %}completed{% elif step == 1 %}active{% endif %}">1</div>
            <div class="step {% if step >= 2 %}completed{% elif step == 2 %}active{% endif %}">2</div>
            <div class="step {% if step >= 3 %}completed{% elif step == 3 %}active{% endif %}">3</div>
            <div class="step {% if step >= 4 %}completed{% elif step == 4 %}active{% endif %}">4</div>
            <div class="step {% if step >= 5 %}completed{% elif step == 5 %}active{% endif %}">5</div>
            <div class="step {% if step >= 6 %}completed{% elif step == 6 %}active{% endif %}">6</div>
        </div>

        <!-- Step 1: Welcome and Financial Health Score -->
        {% if step == 1 %}
            <div class="card">
                <div class="card-header">üéâ {{ translations[language]['Welcome'] }}, {{ first_name }}!</div>
                <div class="card-body">
                    <p class="success-message">{{ translations[language]['Submission Success'] }}</p>
                    <p>{{ translations[language]['Email'] }}: {{ email }}</p>
                    <h3>‚≠ê {{ translations[language]['Your Financial Health Score'] }}</h3>
                    <p class="result-text">{{ health_score }}/100</p>
                    <p class="result-text">{{ translations[language]['Ranked'] }} #{{ rank }} {{ translations[language]['out of'] }} {{ total_users }} {{ translations[language]['users'] }}</p>
                    <p class="result-text">
                        {% if health_score >= 75 %}{{ translations[language]['Strong Financial Health'] }}
                        {% elif health_score >= 50 %}{{ translations[language]['Stable Finances'] }}
                        {% elif health_score >= 25 %}{{ translations[language]['Financial Strain'] }}
                        {% else %}{{ translations[language]['Urgent Attention Needed'] }}{% endif %}
                    </p>
                    <p class="note-text">{{ translations[language]['Check Inbox'] }}</p>
                    <a href="{{ url_for('dashboard', step=2, language=language) }}" class="btn btn-primary mt-3">Next</a>
                    <button class="voice-btn mt-3" onclick="alert('Voice guidance coming soon!')">üéôÔ∏è Listen</button>
                </div>
            </div>
        {% endif %}

        <!-- Step 2: Score Breakdown -->
        {% if step == 2 %}
            <div class="card">
                <div class="card-header">üìä {{ translations[language]['Score Breakdown'] }}</div>
                <div class="card-body">
                    <div class="chart-container">
                        <div id="score-breakdown-chart"></div>
                    </div>
                    <p class="insight-text">
                        {{ translations[language]['Score Composition'] }}:
                        <ul>
                            <li><strong>{{ translations[language]['Cash Flow'] }}</strong>: {{ translations[language]['Cash Flow Description'] }}</li>
                            <li><strong>{{ translations[language]['Debt-to-Income Ratio'] }}</strong>: {{ translations[language]['Debt-to-Income Description'] }}</li>
                            <li><strong>{{ translations[language]['Debt Interest Burden'] }}</strong>: {{ translations[language]['Debt Interest Description'] }}</li>
                        </ul>
                        {% if health_score >= 75 %}{{ translations[language]['Balanced Components'] }}
                        {% elif health_score >= 50 %}{{ translations[language]['Components Need Attention'] }}
                        {% else %}{{ translations[language]['Components Indicate Challenges'] }}{% endif %}
                    </p>
                    <a href="{{ url_for('dashboard', step=3, language=language) }}" class="btn btn-primary mt-3">Next</a>
                    <a href="{{ url_for('dashboard', step=1, language=language) }}" class="btn btn-secondary mt-3">Back</a>
                    <button class="voice-btn mt-3" onclick="alert('Voice guidance coming soon!')">üéôÔ∏è Listen</button>
                </div>
            </div>
        {% endif %}

        <!-- Step 3: Badges and Recommended Learning -->
        {% if step == 3 %}
            <div class="card">
                <div class="card-header">üèÖ {{ translations[language]['Your Badges'] }}</div>
                <div class="card-body">
                    {% if badges %}
                        {% for badge in badges %}
                            <span class="badge" onclick="this.style.background = '#FF5722'; alert('Congrats on {{ translations[language].get(badge, badge) }}!')">{{ translations[language].get(badge, badge) }}</span>
                        {% endfor %}
                    {% else %}
                        <p>{{ translations[language]['No Badges Yet'] }}</p>
                    {% endif %}
                    <h3>üìö {{ translations[language]['Recommended Learning'] }}</h3>
                    <div class="d-flex flex-wrap justify-content-center gap-2 mb-3">
                        <a href="{{ course_url }}" target="_blank" class="course-link">{{ course_title }}</a>
                        <a href="{{ course_url }}" target="_blank" class="enroll-button">{{ translations[language]['Enroll Now'] }}</a>
                    </div>
                    <div class="d-flex flex-wrap justify-content-center gap-2 mb-3">
                        <a href="{{ url_for('dashboard', step=4, language=language) }}" class="btn btn-primary mt-3">Next</a>
                        <a href="{{ url_for('dashboard', step=2, language=language) }}" class="btn btn-secondary mt-3">Back</a>
                        <button class="voice-btn mt-3" onclick="alert('Voice guidance coming soon!')">üéôÔ∏è Listen</button>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Step 4: Quick Financial Tips -->
        {% if step == 4 %}
            <div class="card">
                <div class="card-header">üí° {{ translations[language]['Quick Financial Tips'] }}</div>
                <div class="card-body">
                    <ul class="tips-list">
                        {% if health_score >= 75 %}
                            <li><strong>{{ translations[language]['Invest'] }}</strong>: {{ translations[language]['Invest Wisely'] }} <button class="try-it-btn">Try It</button></li>
                            <li><strong>{{ translations[language]['Scale'] }}</strong>: {{ translations[language]['Scale Smart'] }} <button class="try-it-btn">Try It</button></li>
                        {% elif health_score >= 50 %}
                            <li><strong>{{ translations[language]['Build'] }}</strong>: {{ translations[language]['Build Savings'] }} <button class="try-it-btn">Try It</button></li>
                            <li><strong>{{ translations[language]['Cut'] }}</strong>: {{ translations[language]['Cut Costs'] }} <button class="try-it-btn">Try It</button></li>
                        {% else %}
                            <li><strong>{{ translations[language]['Reduce'] }}</strong>: {{ translations[language]['Reduce Debt'] }} <button class="try-it-btn">Try It</button></li>
                            <li><strong>{{ translations[language]['Boost'] }}</strong>: {{ translations[language]['Boost Income'] }} <button class="try-it-btn">Try It</button></li>
                        {% endif %}
                    </ul>
                    <a href="{{ url_for('dashboard', step=5, language=language) }}" class="btn btn-primary mt-3">Next</a>
                    <a href="{{ url_for('dashboard', step=3, language=language) }}" class="btn btn-secondary mt-3">Back</a>
                    <button class="voice-btn mt-3" onclick="alert('Voice guidance coming soon!')">üéôÔ∏è Listen</button>
                </div>
            </div>
        {% endif %}

        <!-- Step 5: How You Compare to Others -->
        {% if step == 5 %}
            <div class="card">
                <div class="card-header">‚öñÔ∏è {{ translations[language]['How You Compare'] }}</div>
                <div class="card-body">
                    <div class="chart-container">
                        <div id="compare-others-chart"></div>
                    </div>
                    <p class="insight-text">
                        {{ translations[language]['Your Rank'] }} #{{ rank }} {{ translations[language]['out of'] }} {{ total_users }} {{ translations[language]['users'] }} {{ translations[language]['places you'] }}:
                        {% if rank <= total_users * 0.1 %}{{ translations[language]['Top 10%'] }}
                        {% elif rank <= total_users * 0.3 %}{{ translations[language]['Top 30%'] }}
                        {% elif rank <= total_users * 0.7 %}{{ translations[language]['Middle Range'] }}
                        {% else %}{{ translations[language]['Lower Range'] }}{% endif %}
                        {{ translations[language]['Regular Submissions'] }}
                    </p>
                    <a href="{{ url_for('dashboard', step=6, language=language) }}" class="btn btn-primary mt-3">Next</a>
                    <a href="{{ url_for('dashboard', step=4, language=language) }}" class="btn btn-secondary mt-3">Back</a>
                    <button class="voice-btn mt-3" onclick="alert('Voice guidance coming soon!')">üéôÔ∏è Listen</button>
                </div>
            </div>
        {% endif %}

        <!-- Step 6: What‚Äôs Next? -->
        {% if step == 6 %}
            <div class="card">
                <div class="card-header">üîì {{ translations[language]['Whats Next'] }}</div>
                <div class="card-body">
                    <div class="d-flex flex-wrap justify-content-center gap-2 mb-3">
                        <a href="{{ url_for('home') }}" class="btn btn-primary">{{ translations[language]['Back to Home'] }}</a>
                        <a href="{{ FEEDBACK_FORM_URL }}" class="btn btn-secondary">{{ translations[language]['Provide Feedback'] }}</a>
                        <a href="{{ WAITLIST_FORM_URL }}" class="btn btn-secondary">{{ translations[language]['Join Waitlist'] }}</a>
                        <a href="{{ CONSULTANCY_FORM_URL }}" class="btn btn-secondary">{{ translations[language]['Book Consultancy'] }}</a>
                    </div>
                    <p class="text-center">
                        {{ translations[language]['Contact Us'] }} 
                        <a href="mailto:Ficoreai@outlook.com">Ficoreai@outlook.com</a> 
                        {{ translations[language]['for support'] }} | 
                        Follow us on 
                        <a href="{{ LINKEDIN_URL }}" target="_blank" style="color: #0A66C2;">LinkedIn</a> and 
                        <a href="{{ TWITTER_URL }}" target="_blank" style="color: #1DA1F2;">Twitter</a>
                    </p>
                    <button class="voice-btn mt-3" onclick="alert('Voice guidance coming soon!')">üéôÔ∏è Listen</button>
                </div>
            </div>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script>
        // Chart Data Setup (same as your original, enhanced with tooltips)
        const chartDataElement = document.getElementById('chart-data');
        let userData = JSON.parse(chartDataElement.dataset.user || '{}');
        let healthScore = JSON.parse(chartDataElement.dataset.healthScore || '0');
        let peerData = JSON.parse(chartDataElement.dataset.peer || '{}');
        let language = chartDataElement.dataset.language || 'English';

        userData = { income: userData.income || 0, expenses: userData.expenses || 0, debt: userData.debt || 0 };
        healthScore = typeof healthScore === 'number' ? healthScore : 0;
        peerData = { averageScore: peerData.averageScore || 50 };

        const chartTranslations = {
            'English': { 'Income': 'Income', 'Expenses': 'Expenses', 'Debt': 'Debt', 'Amount': 'Amount (‚Ç¶)', 'Your Score': 'Your Score', 'Average Peer Score': 'Average Peer Score', 'Financial Health Score': 'Financial Health Score' },
            'Hausa': { 'Income': 'Ku…óin Shiga', 'Expenses': 'Kashe Ku…ói', 'Debt': 'Bashi', 'Amount': 'Adadin (‚Ç¶)', 'Your Score': 'Makin Ku', 'Average Peer Score': 'Matsakaicin Makin Sauran Mutane', 'Financial Health Score': 'Makin Lafiyar Ku…ói' }
        };
        const labels = chartTranslations[language] || chartTranslations['English'];

        // Score Breakdown Chart with Tooltips
        const scoreBreakdownData = [{
            x: [userData.income, userData.expenses, userData.debt],
            y: [labels['Income'], labels['Expenses'], labels['Debt']],
            type: 'bar',
            orientation: 'h',
            marker: { color: ['#28A745', '#FF9800', '#DC3545'] },
            text: [userData.income, userData.expenses, userData.debt].map(v => `‚Ç¶${v.toLocaleString()}`),
            textposition: 'auto',
            hoverinfo: 'text+x'
        }];
        Plotly.newPlot('score-breakdown-chart', scoreBreakdownData, {
            title: '', xaxis: { title: labels['Amount'] }, yaxis: { title: '' }, height: 350, margin: { l: 100, r: 20, t: 20, b: 50 }, plot_bgcolor: 'rgba(0,0,0,0)', paper_bgcolor: 'rgba(0,0,0,0)'
        });

        // Compare Others Chart with Tooltips
        const compareOthersData = [{
            x: [labels['Your Score'], labels['Average Peer Score']],
            y: [healthScore, peerData.averageScore],
            type: 'bar',
            marker: { color: ['#28A745', '#6C757D'] },
            text: [healthScore, peerData.averageScore].map(v => `${v.toFixed(1)}/100`),
            textposition: 'auto',
            hoverinfo: 'text+y'
        }];
        Plotly.newPlot('compare-others-chart', compareOthersData, {
            title: '', xaxis: { title: '' }, yaxis: { title: labels['Financial Health Score'], range: [0, 100] }, height: 350, margin: { l: 50, r: 20, t: 20, b: 50 }, plot_bgcolor: 'rgba(0,0,0,0)', paper_bgcolor: 'rgba(0,0,0,0)'
        });

        // Dynamic Background based on step
        const backgrounds = ['#E3F2FD', '#F5F7FA', '#E8F5E9', '#FFF3E0', '#ECEFF1', '#E0F7FA'];
        document.body.style.background = backgrounds[{{ step - 1 }}];
    </script>
</body>
</html>
