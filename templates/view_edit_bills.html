<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>{{ translations['View and Edit Bills'] }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/comma_format.js') }}"></script>
    <style>
        .ficore-logo { max-width: 200px; margin: 20px auto; display: block; }
        .btn-primary { background-color: #28a745; border-color: #28a745; }
        .btn-primary:hover { background-color: #218838; border-color: #1e7e34; }
        .form-control, .form-select { border-color: #007bff; }
        .alert-container { margin-top: 20px; }
        .table { background-color: #f8f9fa; }
        .category-filter { margin-bottom: 20px; }
        .form-container { max-width: 800px; margin: auto; padding: 0 15px; }
        .table-responsive { overflow-x: auto; }
        .action-btn { min-width: 60px; text-align: center; }
        th, td { white-space: nowrap; }
        @media (max-width: 576px) {
            .table th, .table td { font-size: 14px; padding: 8px; }
            .action-btn { font-size: 12px; padding: 4px 8px; }
            .form-control, .form-select { font-size: 14px; }
        }
        /* Customize with Ficore's actual logo and colors if different */
    </style>
</head>
<body>
    <div class="container text-center">
        <!-- Ficore Logo -->
        <img src="{{ url_for('static', filename='imag/ficore_logo.png') }}" alt="Ficore Africa Logo" class="ficore-logo">
        <!-- Replace 'ficore_logo.png' with your actual logo file -->

        <h1>{{ translations['View and Edit Bills'] }}</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="alert-container">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="category-filter">
            <label for="category">{{ translations['Select Category'] }}</label>
            <select id="category" class="form-select" onchange="window.location.href=this.value">
                <option value="{{ url_for('view_edit_bills', category='all') }}" {% if category == 'all' %}selected{% endif %}>{{ translations['All'] }}</option>
                <option value="{{ url_for('view_edit_bills', category='utilities') }}" {% if category == 'utilities' %}selected{% endif %}>{{ translations['Utilities'] }}</option>
                <option value="{{ url_for('view_edit_bills', category='rent') }}" {% if category == 'rent' %}selected{% endif %}>{{ translations['Rent'] }}</option>
                <option value="{{ url_for('view_edit_bills', category='subscription') }}" {% if category == 'subscription' %}selected{% endif %}>{{ translations['Subscription'] }}</option>
                <option value="{{ url_for('view_edit_bills', category='other') }}" {% if category == 'other' %}selected{% endif %}>{{ translations['Other'] }}</option>
            </select>
        </div>

        {% if bills %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">{{ translations['Description'] }}</th>
                            <th scope="col">{{ translations['Amount'] }}</th>
                            <th scope="col">{{ translations['Due Date'] }}</th>
                            <th scope="col">{{ translations['Status'] }}</th>
                            <th scope="col" class="action-btn">{{ translations['Edit'] }}</th>
                            <th scope="col" class="action-btn">{{ translations['Delete'] }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for bill in bills %}
                            <tr>
                                <td>{{ bill.Description }}</td>
                                <td>₦{{ bill.Amount }}</td>
                                <td>{{ translations['Due'] }} {{ bill.DueDate }}</td>
                                <td>
                                    <a href="{{ url_for('toggle_status', record_id=bill.RecordID) }}" class="btn btn-sm btn-outline-primary">{{ translations[bill.Status] }}</a>
                                </td>
                                <td class="action-btn">
                                    <a href="{{ url_for('view_edit_bills', record_id=bill.RecordID) }}" class="btn btn-sm btn-outline-success">{{ translations['Edit'] }}</a>
                                </td>
                                <td class="action-btn">
                                    <a href="{{ url_for('delete_bill', record_id=bill.RecordID) }}" class="btn btn-sm btn-outline-danger">{{ translations['Delete'] }}</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}

        <div class="form-container">
            <h2>{{ translations['Add New Bill'] }}</h2>
            <form method="POST">
                {{ form.hidden_tag() }}
                <div class="form-group mb-3">
                    <label for="{{ form.description.id }}">{{ translations['What is this bill for?'] }}</label>
                    {{ form.description(class="form-control") }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.amount.id }}">{{ translations['How much is the bill? (₦)'] }}</label>
                    {{ form.amount(class="form-control comma-separated", placeholder="e.g., 10,000") }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.due_date.id }}">{{ translations['When is this bill due?'] }}</label>
                    {{ form.due_date(class="form-control") }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.category.id }}">{{ translations['Category'] }}</label>
                    {{ form.category(class="form-select") }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.recurrence.id }}">{{ translations['How often does this bill occur?'] }}</label>
                    {{ form.recurrence(class="form-select") }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.reminders.id }}">{{ translations['Send me reminders'] }}</label>
                    {{ form.reminders(class="form-select", multiple="multiple") }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.status.id }}">{{ translations['Status'] }}</label>
                    {{ form.status(class="form-select") }}
                </div>
                {{ form.record_id(class="form-control", type="hidden") }}
                <button type="submit" class="btn btn-primary">{{ translations['Save Bill'] }}</button>
            </form>
        </div>

        <div class="mt-3">
            <a href="{{ url_for('bill_form') }}" class="btn btn-secondary">{{ translations['Back'] }}</a>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">{{ translations['Go to Dashboard'] }}</a>
        </div>
    </div>
</body>
</html>
